---
layout: default
title: "Carregar Imagem"
permalink: /event_image/
sitemap: false
---

<section id="image-upload" class="max-w-xl mx-auto py-8">
  <h1 class="page-title">Carregar Imagem do Evento</h1>
  {% unless jekyll.environment == 'development' %}
  <div id="google-area" class="mb-6 p-6 bg-white rounded-lg shadow-lg border-b-4 border-buttons">
    <div id="google-signin"></div>
    <div id="google-user" class="hidden">
      <p class="form-label">Verificado como <span id="user-email"></span></p>
    </div>
  </div>
  {% endunless %}
  <form action="{{ site.env.BACKEND_HOST }}/event_image" method="POST" enctype="multipart/form-data" class="space-y-6">
    <input type="hidden" name="google_token" id="google_token" value="">
    <div>
      <label for="event_image" class="form-label">Imagem <span class="text-red-500">*</span></label>
      <input type="file" name="event_image" id="event_image" required class="form-input" />
    </div>
    <button type="submit" id="submit-btn" class="btn-primary">Enviar</button>
  </form>
  <div id="toast-container" class="fixed inset-x-0 bottom-5 flex flex-col items-center space-y-3 z-50"></div>
</section>

<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
{% unless jekyll.environment == 'development' %}
  let googleCredential = null;
  function initGoogle() {
    if (typeof google !== 'undefined') {
      google.accounts.id.initialize({
        client_id: '730968670456-4kvre8am1isuqe3dbmdqs8845ntog6cq.apps.googleusercontent.com',
        callback: handleGoogle
      });
      google.accounts.id.renderButton(
        document.getElementById('google-signin'),
        { theme: 'outline', size: 'large', text: 'signin_with', locale: 'pt-PT' }
      );
    } else {
      setTimeout(initGoogle, 100);
    }
  }
  function handleGoogle(res) {
    googleCredential = res.credential;
    const payload = JSON.parse(atob(res.credential.split('.')[1]));
    document.getElementById('user-email').textContent = payload.email;
    document.getElementById('google_token').value = res.credential;
    document.getElementById('google-user').classList.remove('hidden');
    document.getElementById('google-signin').classList.add('hidden');
  }
  document.addEventListener('DOMContentLoaded', initGoogle);
{% endunless %}

  document.querySelector('#image-upload form').addEventListener('submit', async (e) => {
{% unless jekyll.environment == 'development' %}
    if (!googleCredential || !document.getElementById('google_token').value) {
      e.preventDefault();
      showToast('É necessário iniciar sessão com o Google.', 'error');
      return;
    }
{% endunless %}
  });

  function showToast(message, type = 'success') {
    const bg = type === 'success' ? 'bg-green-500' : 'bg-red-500';
    const toast = document.createElement('div');
    toast.className = `${bg} text-white px-4 py-2 rounded shadow transition-opacity duration-500`;
    toast.textContent = message;
    document.getElementById('toast-container').appendChild(toast);
    setTimeout(() => {
      toast.classList.add('opacity-0');
      toast.addEventListener('transitionend', () => toast.remove());
    }, 3000);
  }
</script>
